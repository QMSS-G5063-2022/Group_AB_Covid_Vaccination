knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rgdal)
library(geojsonio)
data <- read_csv("/Users/nina/Documents/GitHub/Learning-D3.js-4-Mapping/chapter-10/data/covids.csv")
World_polygon <- readOGR(dsn = "/Users/nina/Documents/GitHub/Data_Stuff_Ghana_Data/country.geojson")
# extract data
dat <- World_polygon@data
# add the data I want to add to the data
dat_updated <- dat %>%
dplyr::select(ISO_A3, ISO_A2,NAME) %>%
# for some reason the iso code for France and Norway are missing
# so I fixed these manually
mutate(ISO_A3 = ifelse(NAME == "France", "FRA", ISO_A3)) %>%
mutate(ISO_A3 = ifelse(NAME == "Norway", "NOR", ISO_A3)) %>%
mutate(ISO_A2 = ifelse(NAME == "France", "FR", ISO_A2)) %>%
mutate(ISO_A2 = ifelse(NAME == "Norway", "NO", ISO_A2)) %>%
mutate(NAME = ifelse(NAME == "N. Cyprus", "Cyprus", NAME)) %>%
mutate(NAME = ifelse(NAME == "Eq. Guinea", "Equatorial Guinea", NAME)) %>%
mutate(NAME = ifelse(NAME == "Dominican Rep.", "Dominican Republic", NAME)) %>%
mutate(NAME = ifelse(NAME == "Central African Rep.", "Central African Republic", NAME)) %>%
mutate(NAME = ifelse(NAME == "United States of America", "United States", NAME)) %>%
left_join(data, by = c("NAME" = "country")) %>%
# I want to colour missing values in grey in the visualization,
# therefore I gave missing values a value of -1.
# This is needed because teh d3.js colour scale I uses needs numeric values
# for the transformation.
mutate(first = ifelse(is.na(first), -1, first)) %>%
mutate(fully = ifelse(is.na(fully), -1, fully)) %>%
as.data.frame()
# transform data to  to right format
pid <- sapply(slot(World_polygon, "polygons"), function(x) slot(x, "ID"))
row.names(dat_updated) <- pid
World_polygon@data <- dat_updated
# Save data
country_json <- geojson_json(World_polygon)
geojson_write(country_json, file = "/Users/nina/Documents/QMSS5063/final_project/rshiny/src/www/data/country.geojson")
shiny::runApp('~/Documents/QMSS5063/final_project/rshiny/src')
